<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Application scenarios - Litrepl Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Application scenarios";
        var mkdocs_page_input_path = "usage/application-scenarios.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Litrepl Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../general-concepts/">General concepts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../formatting/">Formatting documents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vim-plugin/">Vim plugin</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Application scenarios</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#command-line-foreground-evaluation">Command Line, Foreground Evaluation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#command-line-detecting-python-exceptions">Command Line, Detecting Python Exceptions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#command-line-running-remote-interpreters-over-ssh">Command Line, Running Remote Interpreters Over SSH</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#command-line-converting-formatted-markdown-to-jupyter-notebook">Command Line, Converting formatted Markdown to Jupyter Notebook</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#using-fenced-markdown-syntax-extension">Using fenced Markdown syntax extension</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-native-divs-syntax-extension">Using Native divs syntax extension</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#command-line-latex-in-pdf-code-highliting-with-minted">Command Line, Latex In-PDF code highliting with Minted</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#gnu-make-evaluating-code-sections-in-project-documentation">GNU Make, Evaluating Code Sections in Project Documentation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-setting-up-keybindings">Vim, Setting Up Keybindings</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-inserting-new-sections">Vim, Inserting New Sections</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-running-the-initial-section-after-interpreter-restart">Vim, Running the Initial Section After Interpreter Restart</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-evaluating-selected-text">Vim, Evaluating Selected Text</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-in-editor-latex-code-highlighting-with-vimtex">Vim, In-Editor Latex code highlighting with Vimtex</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#vim-calling-for-ai-on-a-visual-selection">Vim, Calling for AI on a visual selection</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../development/common-scenarios/">Common scenarios</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../development/more-scenarios/">Advanced</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../development/insights-limitations/">Insights and limitations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/">Command line and Vim</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../related/">Related projects</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Litrepl Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Usage</li>
      <li class="breadcrumb-item active">Application scenarios</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="application-scenarios">Application Scenarios</h3>
<h4 id="command-line-foreground-evaluation">Command Line, Foreground Evaluation</h4>
<p>When performing batch processing of documents, it might be necessary to initiate
a new interpreter session solely for the evaluation's duration rather than
re-using the currently running session. The <code>--foreground</code> option can be used to
activate this mode.</p>
<!--lignore-->

<pre><code class="language-shell">$ cat document.md.in | litrepl --foreground eval-sections &gt; document.md
</code></pre>
<!--lnoignore-->

<h4 id="command-line-detecting-python-exceptions">Command Line, Detecting Python Exceptions</h4>
<p>Another frequently requested feature is the ability to report unhandled
exceptions. Litrepl can be configured to return a non-zero exit code in such
scenarios.</p>
<!--lignore-->

<pre><code class="language-shell">$ cat document.md
``` python
raise Exception(&quot;D'oh!&quot;)
```
$ cat document.md | litrepl --foreground --exception-exit=200 eval-sections
$ echo $?
200
</code></pre>
<!--lnoignore-->

<p>In this example, the <code>--foreground</code> option instructs Litrepl to start a new
interpreter session, stopping it upon completion. The <code>--exception-exit=200</code>
option specifies the exit code to be returned in the event of unhandled
exceptions.</p>
<h4 id="command-line-running-remote-interpreters-over-ssh">Command Line, Running Remote Interpreters Over SSH</h4>
<p>Litrepl supports running interpreters over SSH on a remote machine. In order to
do so, one needs to create a shell script establishing the communication and
name it in a recognizable way.</p>
<p>For example, consider the case where we edit a local document but all sections
that we want to execute should be run on a remote machine named <code>testbed</code>.</p>
<p>We prepare an executable script named <code>ipython-testbed.sh</code> and put it into a
directory listed in the PATH environment variable. The contents of the script is
the following:</p>
<pre><code class="language-sh">#!/bin/sh
exec ssh testbed -p 22 -- bash --login -c ipython &quot;$@&quot;
</code></pre>
<p>Now, we can process our document as usual, but add <code>ipython-testbed.sh</code> as a new
IPython interpreter:</p>
<pre><code class="language-sh"># Executes code sections on a remote machine.
cat README.md | litrepl --python-interpreter=ipython-testbed.sh
</code></pre>
<p>Note that the string <code>ipython</code> must appear in the interpreter name, to let
Litrepl exercise IPyhton-specific communication settings.</p>
<h4 id="command-line-converting-formatted-markdown-to-jupyter-notebook">Command Line, Converting formatted Markdown to Jupyter Notebook</h4>
<p><a href="https://pandoc.org">Pandoc</a> could be used to conver LitREPL-formatted markdown
documents to the Jupyter Notebook format. In order to make it recognize the code
and result fields, addtional formatting is required. Currently we aware of two
options:</p>
<h5 id="using-fenced-markdown-syntax-extension">Using fenced Markdown syntax extension</h5>
<p>Mark Jupyter sections with fenced-div markup as described in the <a href="https://pandoc.org/MANUAL.html#jupyter-notebooks">Pandoc
manual</a>. Consider the
following <code>file.md</code>:</p>
<pre><code class="language-markdown">:::::: {.cell .code execution_count=1}
```python
print(&quot;Hello Jupyter!&quot;)
```
::: {.output .stream .stdout}
``` result
Hello Jupyter!
```
:::
::::::
</code></pre>
<p>The above format is recognized by both <code>Litrepl</code> and <code>Pandoc</code>, so to
convert it to the Jupyter Notebook format one may run:</p>
<pre><code class="language-sh">$ pandoc file.md -o file.ipynb
</code></pre>
<p>Unfortunately, other renderers may interpret fenced divs incorrectly.</p>
<h5 id="using-native-divs-syntax-extension">Using Native divs syntax extension</h5>
<p>Alternatively, native divs syntax extension could be used. Consider the
following <code>file.md</code> file:</p>
<pre><code>&lt;div class=&quot;cell code&quot;&gt;
```python
print(&quot;Hello Jupyter!&quot;)
```

&lt;div class=&quot;output stream stdout&quot;&gt;
```result
Hello Jupyter!
```
&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Both <code>Litrepl</code> and <code>Pandoc</code> will recognize this format, plus most third-party
renderers will ignore <code>div</code> tags. The downside of this approach is the fact that
pandoc now needs <a href="https://pandoc.org/MANUAL.html#extension-native_divs">native divs
extension</a> to convert the
document:</p>
<pre><code class="language-sh">$ pandoc -f markdown+native_divs file.md -o test.ipynb
</code></pre>
<h4 id="command-line-latex-in-pdf-code-highliting-with-minted">Command Line, Latex In-PDF code highliting with Minted</h4>
<p>The following Latex instructions can be used to properly highlight the code and
result sections. Note, that <code>pygmentize</code> system tool needs to be installed in
the system.</p>
<pre><code class="language-tex">\usepackage{minted}
\renewcommand{\MintedPygmentize}{pygmentize}

% LitREPL-compatible environment for Python code snippets
\newenvironment{python}
  {\VerbatimEnvironment
   \begin{minted}[autogobble,breaklines,fontsize=\footnotesize]{python}}
  {\end{minted}}
\BeforeBeginEnvironment{python}{\begin{mdframed}[nobreak=false,everyline=true]}
\AfterEndEnvironment{python}{\end{mdframed}}

% LitREPL-compatible ai secitons
\newenvironment{ai}
  {\vsp\textbf{User:}\vsp}
  {}
\newenvironment{airesult}
  {\vsp\textbf{AI:}\vsp}
  {}

% LitREPL-compatible environment for code results
\newenvironment{result}
  {\VerbatimEnvironment
   \begin{minted}[autogobble,breaklines,fontsize=\footnotesize]{text}}
  {\end{minted}}
\BeforeBeginEnvironment{result}{\begin{mdframed}[nobreak=true,frametitle=\tiny{Result}]}
\AfterEndEnvironment{result}{\end{mdframed}}

% LitREPL-compatible command for inline code results
\newcommand{\linline}[2]{#2}
\newcommand{\st}[1]{\sout{#1}}
\renewcommand{\t}[1]{\texttt{#1}}
</code></pre>
<p>Hint: Use <code>\usepackage[outputdir=_build]{minted}</code> if you specify a separate
build directory (here - <code>_build</code>). This workarounds a well-known Minted problem.</p>
<h4 id="gnu-make-evaluating-code-sections-in-project-documentation">GNU Make, Evaluating Code Sections in Project Documentation</h4>
<p>A typical Makefile recipe for updating documentation is structured as follows:</p>
<pre><code class="language-Makefile">SRC = $(shell find -name '*\.py')

.stamp_readme: $(SRC) Makefile
    cp README.md _README.md.in
    cat _README.md.in | \
        litrepl --foreground --exception-exit=100 \
                --python-interpreter=ipython \
                --sh-interpreter=- \
        eval-sections &gt;README.md
    touch $@

.PHONY: readme
readme: .stamp_readme
</code></pre>
<p>Here, <code>$(SRC)</code> is expected to include the filenames of dependencies. With this
recipe, we can run <code>make readme</code> to evaluate the python sections. By passing <code>-</code>
wealso tell Litrepl to ignore shell sections.</p>
<h4 id="vim-setting-up-keybindings">Vim, Setting Up Keybindings</h4>
<p>The <code>litrepl.vim</code> plugin does not define any keybindings, but users could do it
by themselves, for example:</p>
<pre><code class="language-vim">nnoremap &lt;F5&gt; :LEval&lt;CR&gt;
nnoremap &lt;F6&gt; :LEvalAsync&lt;CR&gt;
</code></pre>
<h4 id="vim-inserting-new-sections">Vim, Inserting New Sections</h4>
<p>The <code>litrepl.vim</code> plugin doesn't include tools for creating section formatting,
however they can be added easily if required. Below, we demonstrate how to
define the <code>:C</code> command inserting new <code>python</code> sections.</p>
<!--lignore-->

<pre><code class="language-vim">command! -buffer -nargs=0 C normal 0i``` python&lt;CR&gt;```&lt;CR&gt;&lt;CR&gt;``` result&lt;CR&gt;```&lt;Esc&gt;4k
</code></pre>
<!--lnoignore-->
<!---``` <- to make TokOpen() happy -->

<h4 id="vim-running-the-initial-section-after-interpreter-restart">Vim, Running the Initial Section After Interpreter Restart</h4>
<p>Below we demonstrate how to define the <code>:LR</code> command for running first section
after the restart.</p>
<pre><code class="language-vim">command! -nargs=0 LR LRestart | LEval 0
</code></pre>
<h4 id="vim-evaluating-selected-text">Vim, Evaluating Selected Text</h4>
<p>Litrepl vim plugin defines <code>LitReplEvalSelection</code> function which runs the
selection as a virtual code section. The section type is passed as the function
argument.  For example, calling <code>LitReplEvalSelection('ai')</code> will execute the
selection as if it is an <code>ai</code> code section. The execution result is pasted right
after the selection as a plain text. <code>LitReplEvalSelection('python')</code> would pipe
the selection through the current Python interpreter.</p>
<p>To use the feature, define a suitable key binding (<code>Ctrl+K</code> in this example),</p>
<!--lignore-->

<pre><code class="language-vim">vnoremap &lt;C-k&gt; :call LitReplEvalSelection('ai')&lt;CR&gt;
</code></pre>
<!--lnoignore-->

<p>Now write a question to the AI in any document, select it and hit Ctrl+K.</p>
<pre><code>Hi model. What is the capital of New Zealand?
</code></pre>
<p>Upon the keypress, Litrepl pipes the selection through the AI interpreter - the
<code>aicli</code> at the time of this writing - and paste the response right after the
last line of the original selection.</p>
<pre><code>Hi model. What is the capital of New Zealand?
The capital of New Zealand is Wellington.
</code></pre>
<p>Internally, the plugin just uses <code>eval-code</code> Litrepl command.</p>
<h4 id="vim-in-editor-latex-code-highlighting-with-vimtex">Vim, In-Editor Latex code highlighting with Vimtex</h4>
<p>The following <code>.vimrc</code> Vimtex configuration enables highlighting of Python
code sections in LaTeX documents. We typically need to call these functions from
the <code>BufEnter</code> event handler.</p>
<pre><code class="language-vim">&quot; .localvimrc
call vimtex#syntax#nested#include('python')
call vimtex#syntax#core#new_region_env('texLitreplZone', 'l[a-zA-Z0-9]*code',
  \ {'contains': '@vimtex_nested_python'})
</code></pre>
<h4 id="vim-calling-for-ai-on-a-visual-selection">Vim, Calling for AI on a visual selection</h4>
<p><em>Note: <code>litrepl_extras.vim</code> has been reworked since 3.14.0.</em></p>
<p><em>Note: this is not stable and a subject to change.</em></p>
<p>The repository includes <code>litrepl_extras.vim</code>, which defines a generic
interface for external textâ€‘rewriting tools. While it can work with a variety
of backends, it is primarily designed to integrate smoothly with
<a href="https://github.com/sergei-mironov/aicli">Aicli</a> sessions powered by Litrepl.</p>
<p>The <code>litrepl_extras.vim</code> defines the following Vim commands:</p>
<ul>
<li><code>:LPush[!] &lt;script&gt; &lt;prompt&gt;</code> Calls the <code>litrepl-&lt;script&gt;</code> executable and
  echoes its output.</li>
<li><code>:LPipe[!] &lt;script&gt; &lt;prompt&gt;</code> pipes the selection through the
  <code>litrepl-&lt;script&gt;</code> executable (if there is a selection) or inserts the
  executable's output at the cursor position.</li>
<li><code>:LPipeFile[!] &lt;script&gt; &lt;prompt&gt;</code> pipes the current file through the
  <code>litrepl-&lt;script&gt;</code> executable (if there is a selection) or inserts the
  executable's output at the cursor position.</li>
</ul>
<p>All the above commands get translated into a command line matching
the following convension (subject to change):</p>
<pre><code class="language-sh">usage: litrepl-&lt;script&gt; [-h] [-P PROMPT_LIST] [-s SELECTION_PASTE]
                        [-S SELECTION_RAW] [-f OUTPUT_FORMAT] [-w TEXTWIDTH]
                        [-v] [--location NAME LOC]
                        [--location-raw NAME LOC] [--command COMMAND]
                        ...

positional arguments:
  files

options:
  -h, --help            show this help message and exit
  -P PROMPT_LIST, --prompt PROMPT_LIST
  -s SELECTION_PASTE, --selection-paste SELECTION_PASTE
  -S SELECTION_RAW, --selection-raw SELECTION_RAW
  -f OUTPUT_FORMAT, --output-format OUTPUT_FORMAT
  -w TEXTWIDTH, --textwidth TEXTWIDTH
  -v, -d, --debug, --verbose
  --dry-run
  --location NAME LOC
  --location-raw NAME LOC
  --command COMMAND
</code></pre>
<p>The <code>command</code> is currently set to the fixed <code>eval-code</code> string literal.</p>
<p>The bang versions of the Vim commands cause <code>-S</code> (disable escaping commands
within the selection) to be used instead of <code>-s</code> (escape the selection). For
Aicli this means that the /commands would be executed rather than passed to an
LLM model.</p>
<p>Users are free to write their own scripts. The completion will try to match
the <code>litrepl-*</code> pattern to a unique match. For example, below is the example
of the <code>litrepl-grammar.sh</code> script, which asks AI to correct the grammar of
the selected text:</p>
<pre><code class="language-sh">#!/bin/sh

exec litrepl-aicli.py -P &quot;Please correct English grammar within the 'selection'. Keep the choice of words, minimize the changes you make.&quot; &quot;$@&quot;
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../vim-plugin/" class="btn btn-neutral float-left" title="Vim plugin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../development/common-scenarios/" class="btn btn-neutral float-right" title="Common scenarios">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../vim-plugin/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../development/common-scenarios/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
